<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>FOSDEM::Perl </title>
    
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/extra.css">
    <link rel="stylesheet" href="css/theme/white.css">
    
    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">
    
    <!-- Printing and PDF exports -->
    <script>
     var link = document.createElement( 'link' );
     link.rel = 'stylesheet';
     link.type = 'text/css';
     link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
     document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
	<section><img src='img/paula-iv-ci.jpg' style='height:600px' alt='Clase de IV por Paula'>
	  <h3>Drawing by <a href='http://dev.to/terceranexus6'>Paula "TerceraNexus6"</a></h3>
	</section>
	
	<section><h1>Testing for testing</h1>
	  <h2>Using continuous integration in the classroom</h2>
	  <h3><code>@jjmerelo</code>, Granada Perl Mongers</h3>
	  <aside class='notes'>Why you should be interested in this?
	  Teaching is not one of
	  the <a href='http://www.cracked.com/blog/5-jobs-everyone-in-world-should-have-at-some-point/'>5
	      jobs everyone should have at some point.</a>, but it is
	  in <a href='https://www.theodysseyonline.com/10-jobs-everyone-should-have-to-do'>in
	      this other list, teacher.</a>. Everyone has to teach,
	  and you could as well do it the best way you can. </aside>
	</section>

	<!-- A bit of context -->
	<section>
	  <section data-background='https://farm1.staticflickr.com/555/31684311563_74426eccc2_k_d.jpg' alt='class of 2016-17, master'>
	    <h1>Cloud computing class</h1>
	    <h2>Undergraduate and master CS level</h2>
	    <aside class='notes'>This is last year's class. I have less than a dozen students in master's and around 30 in undergrad level</aside>
	  </section>

	  <section data-background='https://farm6.staticflickr.com/5136/5489474407_596a9224f2_o_d.jpg'>
	    <h1>Flipped learning</h1>
	    <aside class='notes'>This emphasizes doing over listening,
	    and there's a more direct interaction with the student. It
	    also encourages students to learn at their own pace, doing
	      stuff when they see fit</aside>
	  </section>

	  <section data-background='https://farm3.staticflickr.com/2111/2258467154_caa7f0dd4f_o_d.jpg'
	    alt='Astronautas que no son de verdad'>
	    <h1>Class ~~ Real life</h1>
	    <h2 class='fragment'>Class as a metaphor for
	      real life<sup>TM</sup></h2>
	    <aside class='notes'>Use the same class tools you would
	    use for the matter of the class: git for deployment, pull
	      requests, issues and milestones... </aside>
	  </section>

	  <section data-background='img/github.png'>
	    <h1>GitHub is my LMS</h1>
	    <aside class='notes'>GitHub is excellent as a learning
	    management system. Besides, it encourages students to use
	    and develop free software, and to be original. Its search
	      engine is also great for detecting plagiarism.</aside>
	  </section>
	</section>

	<!-- A new beginning -->
	<section>
	  <section data-background='https://farm2.staticflickr.com/1560/25883822136_f25e9b9347_o_d.jpg'
		   alt='dawn over Lawyer's creek'>
	    <h1>2017: a new beginning</h1>
	    <aside class='notes'>Fired from my appointment as director
	    of the free software office, all of a sudden I had a lot
	    of time in my hands... And lost the assistant that checked
	    assignments before grading them. So it was a match made in
	      heaven, and I just had the tool for doing that.</aside>
	  </section>

	  <section data-background='https://farm5.staticflickr.com/4057/4272142306_98f0ff1a33_o_d.jpg'
	    alt='Hudson siren'>
	    <h1>Continuous integration to the rescue</h1>
	    <aside class='notes'>In fact, CI is part of the class and
	    they have to set it up for their projects from early
	    on. But in this case, the idea was to run tests on the
	      pull requests they made.</aside>
	  </section>

	  <section data-background='img/pull-request.png'>
	    <h1>Milestone release ~~ code review</h1>

	    <aside class='notes'>Thus we delved even deeper into the
	    metaphor: they had to deploy a milestone, and the
	    professor was the master that did the code review, looking
	      at the test problems. </aside>
	  </section>
	</section>

	<section> <!-- Checks and balances -->
	  <section><h1>What do we check?</h1>
	  </section>
	  <section><h1>Assignment == 1 line</h1>
	    <h2 class='fragment'>Repo URL is correct</h2>
	  </section>
	  
	  <section
	  data-background='https://farm1.staticflickr.com/619/20996949839_9be1423b2c_k_d.jpg'
alt='cute plush camel'><h1>Perl to the rescue</h1>
	    <aside class='notes'>This was not a difficult choice at
	  all. I had been using perl with git for some time, and of
	  course regexen and other things are a breeze. So I didn't
	      even think about using other languages.</aside>
	  </section>


	  
	  <section><h2>Get the new submission from the diff</h2>
	    <pre><code>my $repo = Git->repository ( Directory => '.' );
my $diff = $repo->command('diff','HEAD^1','HEAD');
my $diff_regex = qr/a\/proyectos\/hito-(\d)\.md/;
my $github;
my ($this_hito) = ($diff =~ $diff_regex);
skip "No hay env√≠o de proyecto", 5 unless defined $this_hito;
my @files = split(/diff --git/,$diff);
my ($diff_hito) = grep( /$diff_regex/, @files);
	    </code></pre></section>

	  
	  <section><h2>Is it a single line? ‚Éí</h2>

	    <pre><code>my @lines = split("\n",$diff_hito);
my @adds = grep(/^\+[^+]/,@lines);
is( $#adds, 0, "A√±ade s√≥lo una l√≠nea");
my $url_repo;
if ( $adds[0] =~ /\(http/ ) {
  ($url_repo) = ($adds[0] =~ /\((http\S+)\)/);
} else {
  ($url_repo) = ($adds[0] =~ /^\+.+(http\S+)/s);
}
say $url_repo;
isnt($url_repo,"","El env√≠o incluye un URL");
like($url_repo,qr/github.com/,"El URL es de GitHub");
</code></pre>
	  </section>

	  <section><h1>Download student's repo</h1>
	    <pre><code>my ($user,$name) = ($url_repo=~ /github.com\/(\S+)\/(.+)/);
my $repo_dir = "/tmp/$user-$name";
if (!(-e $repo_dir) or  !(-d $repo_dir) ) {
  mkdir($repo_dir);
  `git clone $url_repo $repo_dir`;
}
my $student_repo =  Git->repository ( Directory => $repo_dir );
my @repo_files = $student_repo->command("ls-files");</code></pre>

	    <aside class='notes'>Maybe I could use Git for that,
	      instead of the external command. Works well, anyway.</aside>
	  </section>
	  
	  <section>
	    <h1><code>Git</code> + <code>Test::More</code></h1>
	  </section>

	  <section><h1>A simple Travis configuration</h1>
	    <pre><code>branches:
  except:
    - gh-pages
language: perl
perl:
  - "5.16"
before_install:
install: cpanm Test::More Test::Harness Git File::Slurper JSON Net::Ping TAP::Formatter::Color Term::ANSIColor
script: prove -c
	    </code></pre>
	  </section>
	  <section data-background='img/travis-history.png'>
	    <h1>Checking...</h1>
	  </section>

	  <section><h1>Also checking</h1>
	    <h2 class='fragment'>Presence of files and directories in repo</h2>
	    <h2 class='fragment'>Extracting URLs and DNS names via
	      regexen</h2>
	  </section>

	  <section data-background='img/fails.png'>
	    <h1>Test fails ‚ö± ‚Üí Try again</h1>
	  </section>

	  <section><h1>Scraping for fun and profit</h1>
	    <h2 class='fragment'>Instant API ‚òª</h2>
	    <h2 class='fragment'>Checking milestones, issues and
	      commits</h2>
	    <aside class='notes'>The first version used GitHub's API,
	    but eventually it dawned on me that you can't use
	    environment variables in pull requests so I had to make do
	      with scraping. </aside>
	  </section>

	  <section>
	    <h1>Getting milestones info ‚õº </h1>
	    <pre><code>my $page = get( "https://github.com/$user/$repo/milestones" );
my ($milestones ) = ( $page =~ /(\d+)\s+Open/);</code></pre>

	    <pre class='fragment'><code>my $page = get( "https://github.com/$user/$repo".'/issues?q=is%3Aissue+is%3Aclosed' );
my (@closed_issues ) = ( $page =~ m{<li\s+(id=.+?</li>)}gs ); </code></pre>

	    <pre class='fragment'><code>my $page = get( "https://github.com/$user/$repo/issues/$issue" );
return $page =~ /closed\s+this\s+in/gs ;</code></pre>

	  </section>

	  <section data-background='img/ok.png'><h1>Checks IPs, REST APIs, URLs...</h1>
	  </section>

	  <section><h1>Reaching out ùåì</h1>
	    <pre><code>my $status = get "http://$deployment_url/status";
isnt( $status, undef, "Despliegue correcto en $deployment_url/status" );
my $status_ref = from_json( $status );
like ( $status_ref->{'status'}, qr/[Oo][Kk]/, "Status de $deployment_url correcto");</code></pre>

	    <pre class='fragment'><code>  my $pinger = Net::Ping->new();
  $pinger->port_number(22); # Puerto ssh
  isnt($pinger->ping($ip), 0, "$ip es alcanzable");</code></pre>

	  </section>

	</section>



	<!-- credits -->
	<section>
	    <h2>Credits</h2>
	    <ul class='credits'>
	      <li>CI drawing
		by <a href='http://twitter.com/terceranexus6'>Paula</a></li>
	      <li>Hudson siren
		by <a href='https://www.flickr.com/photos/jankrutisch/4272142306/'>Jan
		  Krutisch</a>
	      </li>
	  </ul>
	</section>

	
	<!-- End -->
	
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    
    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
      history: true,
      width: '90%',
      
      dependencies: [
      { src: 'plugin/markdown/marked.js' },
      { src: 'plugin/markdown/markdown.js' },
      { src: 'plugin/notes/notes.js', async: true },
      { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
      ]
      });
    </script>
  </body>
</html>
